<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b2a4a" />
  <title>Participa DF ‚Äî Ouvidoria Acess√≠vel (Prot√≥tipo)</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <link rel="stylesheet" href="mapa.css">


</head>

<body>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <a class="skip-link" href="#conteudo">Pular para o conte√∫do</a>

  <header class="site-header" role="banner">
    <div class="container">
      <h1 class="title">Participa DF ‚Äî Ouvidoria Acess√≠vel</h1>
      <p class="subtitle">Prot√≥tipo PWA com multicanalidade, protocolo e prote√ß√£o de dados pessoais.</p>
    </div>
  </header>

  <main id="conteudo" class="container" role="main">
    <!-- √Årea de mensagens globais (acess√≠vel para leitores de tela) -->
    <div id="statusGlobal" class="sr-status" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- Form√°lario registrar manifesta√ß√£o-->
    <section class="card" aria-labelledby="tituloForm">
      <h2 id="tituloForm">Registrar manifesta√ß√£o</h2>
    <!-- Bot√£o para consulta manifesta√ß√£o-->
      <div class="top-actions">
        <button type="button" class="link-btn" id="btnAbrirConsulta">
          üîé Consultar protocolo
        </button>
      </div>
        
      <!-- Modal para consulta protocolo-->
   <dialog id="dlgConsulta" aria-labelledby="tituloDlgConsulta">
      <div class="card">
        <h3 id="tituloDlgConsulta">Consultar manifesta√ß√£o</h3>
        <p class="help">Informe o protocolo para abrir a consulta em nova aba.</p>

      <form id="formConsultaModal">
        <label for="consultaProtocoloModal">Protocolo</label>
        <input
        id="consultaProtocoloModal"
        name="consultaProtocoloModal"
        type="text"
        placeholder="Ex.: DF-2026-123456"
        autocomplete="off"
      />
        <p class="error" id="consultaProtocoloErroModal" hidden></p>

      <div class="actions">
        <button type="submit" class="btn btn-primary" id="btnConsultarModal">
          Consultar
        </button>
        <button type="button" class="btn" id="btnFecharConsulta">
          Fechar
        </button>
      </div>
    </form>
   </div>
  </dialog>

  <!-- C√≥digo para receber timeline + hist√≥rico + PDF.-->
  <div id="consultaResultado" class="info-box" hidden aria-live="polite" aria-atomic="true">
    <p><strong>Protocolo:</strong> <span id="crProto"></span></p>
    <p><strong>Status:</strong> <span id="crStatus"></span></p>
    <p><strong>Prazo estimado:</strong> <span id="crPrazo"></span></p>
  
     <!-- Resumo da manifesta√ß√£o -->
    <h4 style="margin-top:12px;">Resumo da manifesta√ß√£o</h4>

    <dl class="preview-list" id="crResumo">
     <dt>Tipo</dt>
     <dd id="crTipo"></dd>

     <dt>Relato</dt>
      <dd id="crDescricao"></dd>

     <dt>√ìrg√£o</dt>
     <dd id="crOrgao"></dd>

     <dt>Local / Endere√ßo</dt>
     <dd id="crLocal"></dd>

      <dt>Identifica√ß√£o</dt>
      <dd id="crIdentificacao"></dd>

      <dt>Anexos (nomes)</dt>
      <dd id="crAnexos"></dd>
   </dl>

   <h4 style="margin-top:12px;">An√°lise autom√°tica (IZA)</h4>
    <div class="info-box" id="crIzaBox" aria-live="polite">
      <p><strong>Tema:</strong> <span id="crIzaTema"></span></p>
      <p><strong>√ìrg√£o sugerido:</strong> <span id="crIzaOrgao"></span></p>
      <p><strong>Prioridade:</strong> <span id="crIzaPrioridade"></span></p>
      <p><strong>Confian√ßa (simulada):</strong> <span id="crIzaConfianca"></span></p>

     <div id="crIzaAlertasWrap" hidden>
      <p><strong>Alertas:</strong></p>
      <ul id="crIzaAlertas" class="history"></ul>
     </div>

     <p class="help" style="margin-top:8px;">
      Observa√ß√£o: Esta triagem √© autom√°tica (prot√≥tipo) e pode ser revisada pelo servidor da Ouvidoria.
     </p>
    </div>



    <h4 style="margin-top:12px;">Linha do tempo</h4>
    <ol class="timeline" id="crTimeline">
    <!-- preenchido pelo JS -->
    </ol>

    <h4 style="margin-top:12px;">Hist√≥rico</h4>
    <ul id="crHistorico" class="history">
    <!-- preenchido pelo JS -->
    </ul>

    <div class="actions" style="margin-top:10px">
      <button type="button" class="btn" id="btnExportarConsultaPDF">
       Exportar PDF (Imprimir)
      </button>
    </div>
  </div>


      <!-- Formul√°rio de criar manifesta√ß√£o -->
    <form id="formManifestacao" novalidate>
        <fieldset class="fieldset">
          <legend>Tipo e conte√∫do</legend>

          <div class="field">
            <label for="tipo">Tipo de manifesta√ß√£o</label>
            <select id="tipo" name="tipo" required aria-describedby="tipoAjuda">
              <option value="">Selecione...</option>
              <option value="reclamacao">Reclama√ß√£o</option>
              <option value="denuncia">Den√∫ncia</option>
              <option value="solicitacao">Solicita√ß√£o</option>
              <option value="elogio">Elogio</option>
              <option value="sugestao">Sugest√£o</option>
              <option value="geral">Geral / N√£o sei classificar</option>
            </select>
            <p id="tipoAjuda" class="help">
              Se n√£o souber qual tipo escolher, use <strong>Geral / N√£o sei classificar</strong>.
              A Ouvidoria far√° a triagem.
            </p>
            <p class="error" id="tipoErro" role="alert" hidden></p>
          </div>

          <div class="field">
            <label for="descricao">Relato (texto)</label>
            <textarea
            id="descricao"
            name="descricao"
            rows="6"
            required
            maxlength="2000"
            aria-describedby="descricaoAjuda descricaoContador piiAviso"
           ></textarea>


            <p id="descricaoAjuda" class="help">
              Dica: descreva <strong>o que aconteceu</strong>, <strong>quando</strong>, <strong>onde</strong> e
              <strong>como</strong>. Evite inserir dados pessoais desnecess√°rios.
            </p>
            <p id="descricaoContador" class="help" aria-live="polite" aria-atomic="true">
              0 / 2000 caracteres
            </p>


            <!-- Aviso de PII (dados pessoais) -->
            <div id="piiAviso" class="pii-box" role="alert" aria-live="polite" hidden>
              <p><strong>Aten√ß√£o:</strong> identificamos poss√≠vel <strong>dado pessoal</strong> no texto (ex.: CPF, e-mail ou telefone).</p>
              <div class="pii-actions">
                <button type="button" class="btn" id="btnMascarar">Mascarar automaticamente</button>
                <button type="button" class="btn btn-secondary" id="btnIgnorarPii">Ignorar aviso</button>
              </div>
              <p class="help">
                Recomenda√ß√£o (LGPD): informe apenas o necess√°rio. Para den√∫ncias, prefira anexar evid√™ncias sem expor dados pessoais.
              </p>
            </div>

            <p class="error" id="descricaoErro" role="alert" hidden></p>
          </div>

           <div class="field grid-2">
            <div>
              <label for="orgao">√ìrg√£o/assunto (opcional)</label>
              <input id="orgao" name="orgao" type="text" autocomplete="off" />
              <p class="help">Se souber, informe o √≥rg√£o relacionado. Isso ajuda na triagem.</p>
            </div>

            <div class="field-inline">
              <label for="local" id="labelLocal">
                Local (opcional)
              </label>
              <div class="field-inline-input">
              <textarea
                id="local"
                name="local"
                rows="1"
                placeholder="Descreva o local ou pesquise no mapa"
              ></textarea>
              <button
                type="button"
                id="btnMapaLocal"
                class="btn-mapa"
                aria-label="Selecionar local no mapa"
                title="Selecionar local no mapa"
              >
                <p class="help">Pesquisar no mapa üó∫Ô∏è</p>  
                
              </button>
              </div>
            </div>


            <!-- Campos ocultos para salvar lat/lng/endere√ßo resolvido -->
             <input type="hidden" id="localLat" name="localLat" value="">
             <input type="hidden" id="localLng" name="localLng" value="">
             <input type="hidden" id="localEndereco" name="localEndereco" value="">

          </div>
        </fieldset>

        <fieldset class="fieldset">
          <legend>Envio multicanal</legend>

          <div class="field">
            <label for="anexos">Anexos (√°udio, imagem, v√≠deo)</label>
            <input
              id="anexos"
              name="anexos"
              type="file"
              multiple
              accept="audio/*,image/*,video/*,application/pdf"
              aria-describedby="anexosAjuda"
            />
              <p id="anexosLimites" class="help">
              Limites do Sistema: at√© <strong>20 MB</strong> por arquivo e <strong>50 MB</strong> no total.
              Tipos aceitos: √°udio, imagem, v√≠deo e PDF.
            </p>

            <div class="attachments" aria-live="polite" aria-atomic="true">
              <p id="anexosResumo" class="help">Nenhum anexo selecionado.</p>
              <p id="anexosTotal" class="help">Tamanho total: 0 KB</p>
              <div id="anexosAvisos" class="notice" role="alert" aria-live="assertive" aria-atomic="true" hidden>
                <div class="notice-header">
                  <strong>Problemas nos anexos</strong>
                  <button type="button" class="btn btn-small" id="btnFecharAvisosAnexos" aria-label="Fechar avisos de anexos">
                    Fechar
                  </button>
                </div>
                <ul id="anexosAvisosLista" class="notice-list"></ul>
              </div>

              <ul id="listaAnexos" class="attachment-list" aria-label="Lista de anexos selecionados"></ul>

              <div class="actions" style="margin-top:10px">
                <button type="button" class="btn btn-secondary" id="btnLimparAnexos">
                  Remover todos os anexos
                </button>
              </div>
            </div>

          </div>
        </fieldset>

        <fieldset class="fieldset">
          <legend>Identifica√ß√£o</legend>

          <div class="field">
            <div class="toggle-row">
              <input id="anonimo" name="anonimo" type="checkbox" />
              <label for="anonimo"><strong>Enviar de forma an√¥nima</strong></label>
            </div>

            <div id="anonimoAviso" class="info-box" role="note" aria-live="polite" hidden>
              <p>
                Voc√™ marcou <strong>an√¥nimo</strong>. Isso significa que sua identifica√ß√£o n√£o ser√° solicitada.
              </p>
            </div>
          </div>

          <div class="field grid-2" id="identificacaoCampos">
            <div>
              <label for="nome">Nome (opcional)</label>
              <input id="nome" name="nome" type="text" autocomplete="name" />
            </div>
            <div>
              <label for="email">E-mail (opcional)</label>
              <input id="email" name="email" type="email" autocomplete="email" />
            </div>
          </div>

          <p class="help">
            Dica de privacidade: use o anonimato quando n√£o for necess√°rio receber retorno por e-mail.
          </p>
        </fieldset>

        <div class="actions">
          <button type="submit" class="btn btn-primary" id="btnEnviar">
            Enviar e gerar protocolo
          </button>
          <button type="button" class="btn" id="btnLimpar">
            Limpar
          </button>
        </div>
      </form>
    </section>

    <section class="card" id="secPreview" hidden aria-labelledby="tituloPreview">
  <h2 id="tituloPreview">Conferir manifesta√ß√£o</h2>

  <p class="help">
    Revise as informa√ß√µes antes de enviar. Voc√™ pode editar se necess√°rio.
  </p>

  <dl class="preview-list">
    <dt>Tipo de manifesta√ß√£o</dt>
    <dd id="pvTipo"></dd>

    <dt>Relato</dt>
    <dd id="pvDescricao"></dd>

    <dt>√ìrg√£o sugerido</dt>
    <dd id="pvOrgao"></dd>

    <dt>Local / Endere√ßo</dt>
    <dd id="pvLocal"></dd>

    <dt>Anexos</dt>
    <dd id="pvAnexos"></dd>

    <dt>Identifica√ß√£o</dt>
    <dd id="pvIdentificacao"></dd>
  </dl>

  <div class="actions">
    <button type="button" class="btn btn-secondary" id="btnEditarPreview">
      Editar
    </button>

    <button type="button" class="btn btn-primary" id="btnConfirmarEnvio">
      Confirmar e enviar
    </button>
  </div>
</section>


  <section class="card" aria-labelledby="tituloResultado" id="secResultado" hidden>
    <h2 id="tituloResultado">Confirma√ß√£o</h2>

    <div class="proto-box" role="status" aria-live="polite" aria-atomic="true">
      <p><strong>Protocolo:</strong> <span id="protocolo"></span></p>
      <p><strong>Status:</strong> <span id="statusAtual">Recebido</span></p>
      <p><strong>Prazo estimado:</strong> <span id="prazoEstimado"></span></p>
    </div>
       <button type="button" class="btn btn-secondary" id="btnEnviarEmail">
       Enviar por e-mail
       </button>

      <button type="button" class="btn" id="btnImprimirConfirmacao">
       Imprimir / Salvar PDF
      </button>
       <button type="button" class="btn btn-primary" id="btnNova">
        Registrar nova manifesta√ß√£o
      </button>
    </div>
  </section>

  </main>

  <footer class="site-footer">
    <div class="container">
      <p class="help">
        Prot√≥tipo para Hackathon ‚Äî foco em acessibilidade (WCAG), multicanalidade e prote√ß√£o de dados pessoais.
      </p>
    </div>
  </footer>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="mapa.js"></script>
  <script src="app.js"></script>

  <!-- Modal do mapa (Leaflet) -->
  <dialog id="dlgMapaLocal" aria-labelledby="tituloMapaLocal">
   <div class="card" style="max-width: 820px;">
    <h3 id="tituloMapaLocal">Selecionar local no mapa</h3>

    <p class="help">
      Privacidade: ao clicar no mapa, ser√° feita uma consulta de endere√ßo (reverse geocoding) em servi√ßo p√∫blico do OpenStreetMap (Nominatim).
      Se preferir, voc√™ pode apenas usar as coordenadas.
    </p>

    <div id="map" style="height: 380px; border-radius: 12px;"></div>

    <div class="actions" style="margin-top: 12px;">
      <button type="button" class="btn btn-secondary" id="btnCentralizarUsuario">
        Centralizar em minha localiza√ß√£o
      </button>

      <button type="button" class="btn" id="btnFecharMapaLocal">
        Fechar
      </button>
    </div>

    <p class="help" id="mapStatus" aria-live="polite" style="margin-top: 10px;"></p>
  </div>
  </dialog>

</body>
</html>
